<div class="container mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Books</h2>
    <button class="btn btn-success" routerLink="/add">+ Add Book</button>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <input
        class="form-control"
        placeholder="Search by title, author, or category"
        [(ngModel)]="searchTerm"
      />
    </div>
    <div class="col-md-2">
      <button class="btn btn-outline-primary w-100" (click)="onSearch()">
        Search
      </button>
    </div>
  </div>

  <table class="table table-hover">
    <thead class="table-light">
      <tr>
        <th (click)="sort('title')" class="sortable">Title</th>
        <th (click)="sort('author')" class="sortable">Author</th>
        <th (click)="sort('price')" class="sortable">Price</th>
        <th (click)="sort('category')" class="sortable">Category</th>
        <th>Cover</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let b of books">
        <td>{{ b.title }}</td>
        <td>{{ b.author }}</td>
        <td>{{ b.price }}</td>
        <td>{{ b.category }}</td>
        <td>
          <img
            *ngIf="b.coverImageUrl"
            [src]="'http://localhost:8080' + b.coverImageUrl"
            class="cover-thumb"
            (click)="openImage('http://localhost:8080' + b.coverImageUrl)"
          />
        </td>
        <td>
          <button class="btn btn-warning btn-sm me-1" [routerLink]="['/edit', b.id]">
            Edit
          </button>
          <button class="btn btn-danger btn-sm" (click)="delete(b.id!)">
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <ngb-pagination
    [(page)]="page"
    [pageSize]="pageSize"
    [collectionSize]="totalItems"
    (pageChange)="load()"
    class="mt-3"
  >
  </ngb-pagination>
</div>

<!-- Modal for Image View -->
<div class="image-modal" *ngIf="selectedImage" (click)="closeImage()">
  <img [src]="selectedImage" alt="Full Cover Image" class="modal-img" />
</div>

<!-- Toast -->
<div
  class="toast-container position-fixed top-0 end-0 p-3"
  style="z-index: 9999"
  *ngIf="message"
>
  <div
    class="toast show align-items-center text-white"
    [ngClass]="{
      'bg-success': messageType === 'success',
      'bg-danger': messageType === 'danger'
    }"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ message }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        (click)="message = ''"
      ></button>
    </div>
  </div>
</div>
